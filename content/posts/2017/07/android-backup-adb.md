---
author: ["@ottanxyz"]
date: 2017-07-17T00:00:00+00:00
draft: false
title: Androidデバイスにダウンロードしたアプリのデータを含めてバックアップを取得する
type: post
slug: android-backup-adb-6069
categories:
- Android
tags:
- Development
---

![](/uploads/2017/07/170716-596af0016e595.jpg)

iOSデバイスの場合、MacもしくはPCにiTunesをインストールしていれば、iTunesにより簡単にフルバックアップ、リストアを実施できますが、Androidの場合は管理ツールがありません。フルバックアップを取得するアプリがGoogle Play等で公開されていますが、Root権限が必要であったり、操作がややこしかったりと慣れるのに時間が必要です。そこで、今回はAndroidのADB（Android Debugging Bridge）と呼ばれるツールを使用してバックアップを取得する方法をご紹介します。

## Androidデバイスのバックアップ

Androidデバイスのバックアップを取得するためには、Mac（もしくはPC）、Androidデバイスそれぞれで準備が必要です。なお、指紋認証等を搭載している機器のセキュリティ情報はバックアップには含まれませんのでご注意ください。

### Mac

PCもしくはMacにADB（Android Debugging Bridge）と呼ばれるツールをインストールします。Macを使用している場合は、Homebrewを使用すれば簡単にインストールできます。ターミナルを開いて下記のコマンドを実行してください。インストール完了後に、ターミナルを再起動してください。

```bash
brew install android-sdk-tools
```

### Android

続いて、Android側の準備です。操作方法は機種によって異なりますので、詳細は各機種の取扱説明書をご覧ください。なお、設定の「開発者向けオプション」はデフォルトでは有効になっていないことが多いのですが、設定の「端末情報」の「ビルド番号」を数回タップすると表示される謎の仕様となっております。

![](/uploads/2017/07/170716-596af07cefe1c.png)

設定の「開発者向けオプション」をタップします。

![](/uploads/2017/07/170716-596af08611fc5.png)

「開発者向けオプション」をチェックし有効にします。

![](/uploads/2017/07/170716-596af08ae0c99.png)

「USBデバッグ」を有効にします。「USBデバッグ」とはMicro-USB⇔USBケーブルを使用して、MacまたはPCにAndroidデバイスを接続した際に、Mac側からAndroidデバイスを操作するために必要な操作です。

![](/uploads/2017/07/170716-596af090d5d1f.png)

最後に、「USB設定」を「充電のみ」から「ファイル（MTP）」モードに変更します。通常、AndroidデバイスをMacに接続した場合、Mac側からの給電のみが有効になっています。USB経由でデータのバックアップを取得するために、モードを「MTP（Media Transfer Protocol）」に変更します。

### バックアップを取得する

続いて、MacとAndroidをUSBケーブルで接続します。接続が完了したら、ターミナルを開いて以下のコマンドを実行します。

```bash
adb backup -f backup_20170716.ab -all -nosystem -apk -obb
```

コマンドのオプションについて説明します。

| オプション | 説明                                                              |
| ---------- | ----------------------------------------------------------------- |
| backup     | adbコマンドを使用してバックアップします                           |
| -f         | バックアップファイルの作成場所のパスを指定します                  |
| -all       | すべてのデータをバックアップします                                |
| -nosystem  | システムアプリのデータをのぞいてバックアップします                |
| -apk       | アプリケーションのapkファイル（本体）をバックアップ対象に含めます |
| -obb       | アプリケーションがダウンロードしたデータをバックアップします      |

コマンドを実行すると、下図の画面がAndroid側に表示されるため、「データをバックアップ」をタップします。なお、パスワードを設定しておくと、次回リストア時に指定したパスワードを使用しない場合、復元できなくなります。

![](/uploads/2017/07/170716-596af09a4b6c1.png)

### バックアップからの復元

取得したバックアップから復元する方法は簡単です。前述の方法でAndroid側の準備（USBデバッグ、MTPモードの設定）を実施し、USBケーブル経由でMacと接続します。接続したらターミナルから以下のコマンドを実行します。

```bash
adb restore <バックアップファイルの場所>
```

Android側にバックアップ時と同様の画面が表示されます。バックアップ時にパスワードを指定している場合は、パスワードを入力しないと復元できません。なお、復元すると端末のデータはバックアップ時のデータにすべて上書きされますのでご注意ください。
