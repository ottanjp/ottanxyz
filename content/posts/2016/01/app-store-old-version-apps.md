---
author: ["@ottanxyz"]
date: 2016-01-06 14:06:22+00:00
draft: false
title: App Storeから古いバージョンのアプリケーションをダウンロードする方法
type: post
slug: app-store-old-version-apps-6824
categories:
- Mac
tags:
- Apps
- Tips
---

![](/uploads/2016/01/160106-568d1f5ddc56f-1.jpg)






App Storeからダウンロードしたアプリのバージョンを最新に保つことは、セキュリティ、機能改善にも役立つことですが、時にアップデートしたことによる不具合に見舞われることがあります。その場合は、今回ご紹介する方法を使用して、任意の古いバージョンをiPhoneにダウンロードできますのでお試しください。





## App Storeから古いバージョンのアプリケーションをダウンロードする





少々、長い行程で面食らいますが、慣れてしまえば同じことの繰り返しですので簡単です。ぜひ、最後までご覧いただければと思います。








##### iTunesのバージョンについて




iTunes 12.7以降のバージョンにおいては、iTunesからApp StoreおよびAppの管理機能が廃止されました。今回ご紹介する方法をお試しする場合には、[企業環境で iTunes を使って App を配布する - Apple サポート](https://support.apple.com/ja-jp/HT208079)から、iTunes 12.6.3をダウンロードしてインストールしてください。








### Charlesのダウンロード





**Charles**は、HTTPプロキシ、HTTPモニター、リバースプロキシとして機能するソフトウェアで、端末⇄サーバ間のHTTP、およびHTTPSのリクエストと応答をモニターリングできます。**Charles**は有償ソフトウェアですが、30日間は無料で試用できます。[こちらのリンク](https://www.charlesproxy.com/)から、試用版のCharles**をダウンロードしてください。





### Charlesのインストール





![](/uploads/2018/02/180206-5a79a7cd1e020.png)






Charlesをダウンロードし、ディスクイメージ（dmg）ファイルをダブルクリックすると、ライセンスが表示されますので「Agree」ボタンをクリックします。





![](/uploads/2016/01/160106-568d0d068cf42.png)






「Charles.app」を「Applications」にコピーすると、インストールは完了です。





### Charlesの起動





![](/uploads/2018/02/180206-5a79a82ee9312.png)






Charlesがネットワークモニターとして機能するために、権限を求められるため「Grant Priviliges」をクリックします。これは、Charlesの初回起動時のみ求められます。





![](/uploads/2018/02/180206-5a79a8402189e.png)






権限の付与には管理者権限が必要であるため、管理者のユーザ名とパスワードを入力します。





![](/uploads/2018/02/180206-5a79a90fb6dd3.png)






以上で、Charlesの起動は完了です。上図に示すボタンをクリックすることで、CharlesによるHTTPプロキシのオン、オフの切り替えを行うことができます（赤くなっていればプロキシがオンの状態）。





### Charlesで古いアプリケーションをダウンロードする





ここからは、Charlesを使用してiTunes Storeから古いバージョンのアプリケーションをダウンロードする方法をご紹介します。





#### ①目的のアプリケーションをダウンロードする





![](/uploads/2018/02/180206-5a79a8a5369a6.png)






Charlesを起動し、HTTPプロキシをオンにします（起動時にはデフォルトでオンになっています）。続いて、iTunesを起動し、App Storeから目的のアプリケーションをダウンロードします。今回は、Facebookを対象とします。





#### ②CharlesのSSLプロキシを有効化する





![](/uploads/2018/02/180206-5a79ab33f03a5.png)






Mac⇄App Store間のHTTPS通信をモニターリングするためには、SSLプロキシを有効化する必要があります。また、HTTPS通信をモニターリングするためにはCharlesの証明書をシステムにインストールする必要があります。Charlesの証明書がインストールされていない状態で、App Storeからアプリをダウンロードしようとすると、「""を購入できませんでした。安全なネットワーク接続を確立できませんでした。このサーバの証明書チェーンは不正です」と警告が表示されます。





![](/uploads/2017/07/170701-595743a49f909.png)






Charlesを起動したら、「Help」→「SSL Proxying」→「Install Charles Root Certificate」を選択します。





![](/uploads/2018/02/180206-5a79ac7ee7bb6.png)






「OK」ボタンをクリックします。すべてのユーザで有効にしたい場合は、「キーチェーン」を「システム」にします。これで、キーチェーンにCharlesのルート証明書が追加されます。SSL通信時にこの証明書が使用されるようになりますが、最新のmacOSでは未知の証明書は使用できないようになっているため、キーチェーンアクセスから有効化します。「アプリケーション」→「ユーティリティ」→「キーチェーンアクセス.app」を開きます。





![](/uploads/2017/07/170701-59574467b75cf.png)






「Charles Proxy CA」というルート証明書を探します。「このルート証明書は信頼されていません」と表示されている場合には、その証明書をダブルクリックしてください。





![](/uploads/2017/07/170701-5957449f9e257.png)






「信頼」というプルダウンをクリックし、「この証明書を信頼するとき」を「常に信頼」に変更してください。これで、Charlesを使用している際に、App StoreとのSSL通信をモニターリングできるようになります。





![](/uploads/2017/07/170701-59574a11754d3.png)






続いて、App Storeから目的のアプリケーションをダウンロードします。Charlesの左ペインの「Structure」タブから`https://**-buy.itunes.apple.com`（**は任意の英数字）を見つけ、HTTPS通信のモニターリングを有効化するために、右クリックして「Enable SSL Proxying」をクリックします。これで次回以降、App Storeに対するHTTPS通信をモニターリングすることができるようになりました。





#### ③目的のアプリケーションをダウンロードする（2回目）





![](/uploads/2018/02/180206-5a79adafbf2c7.png)






iTunesから、①でダウンロードしたアプリケーションを削除し、再度同じアプリをApp Storeからダウンロードします。





#### ④アプリケーションの情報を取得する





![](/uploads/2017/07/170701-59574b3975baf.png)






Charlesの左ペインの「Structure」タブから「`https://**-buy.itunes.apple.com`」を再度見つけます。この時、鍵マークが付いていないことを確認してください。三角形のマークをクリックして展開していくと、`WebObjects`→`MZBuy.woa`→`wa`→`buyProduct`が見つかります。





![](/uploads/2017/07/170701-59574b8853cc2.png)






右側ペインにおいて、上部を「Contents」、下部を「XML Text」に変更して`softwareVersionExternalIdentifiers`のキーワードを検索してください。（⌘+Fでこのキーワードで検索すると便利です）





![](/uploads/2018/02/180206-5a79aec9bf8f8.png)






ここに表示されている番号が、アプリケーションのバージョンを一意に識別する番号になります。古い番号ほど、古いバージョンのアプリケーションになります。ただし、このままでは、アプリケーションのバージョン情報がわかりませんので、再度Charlesで確認します。





![](/uploads/2018/02/180206-5a79aefaa3a26.png)






続いて`bundleShortVersionString`で検索します。ここに表示されている文字列が上記の`softwareVersionExternalIdentifiers`に対応するバージョンになります。今回の場合は、「157.0」です。





#### ⑤古いバージョンのアプリケーションをダウンロードする





![](/uploads/2017/07/170701-59574d4202289.png)






いよいよCharlesを使用して古いバージョンのアプリケーションをダウンロードします。事前にiTunesからダウンロードしたアプリケーションを削除しておきます。左ペインの`WebObjects`→`MZBuy.woa`→`wa`→`buyProduct`を右クリックして、「Breakpoints」をクリックします。これで、App Storeからアプリケーションをダウンロードする際に、特定のポイントで通信が停止するようになります。





![](/uploads/2018/02/180206-5a79afba28efc.png)






再びApp Storeに戻り、ダウンロードしたいアプリケーションをダウンロードします。Charlesに「Breakpoints」が表示されるようになります。「Edit Request」をクリックします。





![](/uploads/2018/02/180206-5a79afe39288a.png)






画面下部から「XML Text」を選択して、XMLの先頭の`appExtVrsId`の番号を書き換えます。書き換えが完了したら「Execute」をクリックします。





![](/uploads/2017/07/170701-59574e3451087.png)






途中、通信が停止した場合は、再度「Execute」をクリックします。最後まで通信が完了したらダウンロードは完了です。





![](/uploads/2018/01/180108-5a5342e2e1993.png)






なお、`bundleShortVersionString`からダウンロードしようとしているアプリのバージョン番号を確認できます。





![](/uploads/2018/02/180206-5a79b1067b05d.png)






これで任意のバージョンのアプリケーションをiTunes Storeからダウンロードすることができました。





![](/uploads/2017/07/170701-59574ed24ab00.png)






再度アプリケーションをダウンロードしようとした場合、再びブレークポイントで通信が遮断されてしまうため、メニューから「Breakponts」を解除しておきましょう。





## まとめ





長い道のりでしたが、道中の工程を簡単に整理すると以下のようになります。






  1. Charlseでアプリケーションの情報を取得する
  2. Charlseでダウンロードしたいアプリケーションの番号を確認する
  3. Charlseでブレークポイントを設定し、ダウンロードしたアプリケーションのバージョン情報に書き換えを行う




この工程を繰り返すことで、任意のアプリケーションの任意のバージョンをダウンロードすることができるようになります。あとは、iTunesとiPhoneを同期することで、古いバージョンをiPhoneに導入することが可能です。





注意点としては、すべてのバージョンがダウンロードできるとは限らない点です。あまりに古いバージョンを指定すると、サーバからエラーが返却されますのでご注意ください。
